<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mathias L. Jeppesen">
<meta name="dcterms.date" content="2025-05-22">

<title>Lab 9 - SVG graphics – STATS 787: Data Visualisation lab assignments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-3c2d062f4b5e1249a867b6bbcc791441.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">STATS 787: Data Visualisation lab assignments</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lab-assignments" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lab assignments</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lab-assignments">    
        <li class="dropdown-header">Lab assignments</li>
        <li>
    <a class="dropdown-item" href="../labs/lab1_answer.html">
 <span class="dropdown-text">Lab1 - Grammar of Graphics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab2_answer.html">
 <span class="dropdown-text">Lab2 - The <code>grid</code> Graphics System</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab3_answer.html">
 <span class="dropdown-text">Lab3 - Effective Data Visualisations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab4_answer.html">
 <span class="dropdown-text">Lab4 - Visual Perception</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab5_answer.html">
 <span class="dropdown-text">Lab5 - Graphic Design</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab6_answer.html">
 <span class="dropdown-text">Lab6 - Animation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab7_answer.html">
 <span class="dropdown-text">Lab7 - Interactive Graphics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab8_answer.html">
 <span class="dropdown-text">Lab8 - Maps</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab9_answer.html">
 <span class="dropdown-text">Lab 9 - SVG graphics</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mathiaslj/stats787uoa-data-visualisation"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title">Lab 9 - SVG graphics</h1>
        </a>     
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Lab assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab1_answer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab1 - Grammar of Graphics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab2_answer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab2 - The <code>grid</code> Graphics System</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab3_answer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab3 - Effective Data Visualisations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab4_answer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab4 - Visual Perception</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab5_answer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab5 - Graphic Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab6_answer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab6 - Animation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab7_answer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab7 - Interactive Graphics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab8_answer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab8 - Maps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab9_answer.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Lab 9 - SVG graphics</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-data-and-questions-of-interest" id="toc-the-data-and-questions-of-interest" class="nav-link active" data-scroll-target="#the-data-and-questions-of-interest">The data and questions of interest</a>
  <ul class="collapse">
  <li><a href="#crime-data" id="toc-crime-data" class="nav-link" data-scroll-target="#crime-data">Crime data</a></li>
  <li><a href="#questions-of-interest" id="toc-questions-of-interest" class="nav-link" data-scroll-target="#questions-of-interest">Questions of interest</a></li>
  </ul></li>
  <li><a href="#data-visualisations-and-questions" id="toc-data-visualisations-and-questions" class="nav-link" data-scroll-target="#data-visualisations-and-questions">Data visualisations and questions</a>
  <ul class="collapse">
  <li><a href="#question-1" id="toc-question-1" class="nav-link" data-scroll-target="#question-1">Question 1</a>
  <ul class="collapse">
  <li><a href="#adding-hyperlinks" id="toc-adding-hyperlinks" class="nav-link" data-scroll-target="#adding-hyperlinks">Adding hyperlinks</a></li>
  <li><a href="#adding-tooltips" id="toc-adding-tooltips" class="nav-link" data-scroll-target="#adding-tooltips">Adding tooltips</a></li>
  <li><a href="#adding-animation" id="toc-adding-animation" class="nav-link" data-scroll-target="#adding-animation">Adding animation</a></li>
  <li><a href="#creating-a-button-to-run-the-animation" id="toc-creating-a-button-to-run-the-animation" class="nav-link" data-scroll-target="#creating-a-button-to-run-the-animation">Creating a button to run the animation</a></li>
  </ul></li>
  <li><a href="#question-2" id="toc-question-2" class="nav-link" data-scroll-target="#question-2">Question 2</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mathiaslj/stats787uoa-data-visualisation/blob/main/labs/lab9_answer.Rmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Lab 9 - SVG graphics</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mathias L. Jeppesen </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 22, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="the-data-and-questions-of-interest" class="level1">
<h1>The data and questions of interest</h1>
<section id="crime-data" class="level2">
<h2 class="anchored" data-anchor-id="crime-data">Crime data</h2>
<p>Data shows rows of incidents handled by the Police.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>crime <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"nzpolice-proceedings.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Generate <code>Month</code> and <code>Year</code> columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>crime<span class="sc">$</span>Month <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(crime<span class="sc">$</span>Date)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>crime<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.POSIXlt</span>(crime<span class="sc">$</span>Date)<span class="sc">$</span>year <span class="sc">+</span> <span class="dv">1900</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Exclude year 2014 for which we only have partial data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>crime <span class="ot">&lt;-</span> <span class="fu">subset</span>(crime, Year <span class="sc">&gt;=</span> <span class="dv">2015</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create data with proportion of men and women in total and stratified by police district.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sexProp <span class="ot">&lt;-</span> <span class="fu">count</span>(crime, SEX) <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>sexProp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     SEX      n      prop
1 Female 216350 0.2853506
2   Male 541840 0.7146494</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sexRegionProps <span class="ot">&lt;-</span> crime <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Police.District, SEX) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop_last"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="at">.keep =</span> <span class="st">"unused"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>sexRegionProps<span class="sc">$</span>Police.District <span class="ot">&lt;-</span> <span class="fu">reorder</span>(sexRegionProps<span class="sc">$</span>Police.District,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                                          sexRegionProps<span class="sc">$</span>prop,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="cf">function</span>(x) x[<span class="dv">1</span>])</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sexRegionProps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  Police.District SEX     prop
  &lt;fct&gt;           &lt;chr&gt;  &lt;dbl&gt;
1 Auckland City   Female 0.260
2 Auckland City   Male   0.740
3 Bay Of Plenty   Female 0.291
4 Bay Of Plenty   Male   0.709
5 Canterbury      Female 0.291
6 Canterbury      Male   0.709</code></pre>
</div>
</div>
<p>Define colors</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">female =</span> <span class="st">"#E46C0A"</span>, <span class="at">male =</span> <span class="st">"#0070C0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="questions-of-interest" class="level2">
<h2 class="anchored" data-anchor-id="questions-of-interest">Questions of interest</h2>
<p>In this lab we are only looking at the proportion of male versus female offenders, either for all of New Zealand or broken into different Police Districts. The data covers offending from 2015 to 2022.</p>
</section>
</section>
<section id="data-visualisations-and-questions" class="level1">
<h1>Data visualisations and questions</h1>
<section id="question-1" class="level2">
<h2 class="anchored" data-anchor-id="question-1">Question 1</h2>
<p>In the SVG code, we create 2 separate <code>&lt;svg&gt;</code> elements to write the text and draw the boxes. The reason for doing so, is to be able to use a <code>viewBox</code> with a specification of <code>0 0 100 100</code> and making sure to specify <code>preserveAspectRatio="none"</code>. In this way, we create a viewport such that we can specify <code>width</code> of rectangles inside the viewBox as the percentage of the total width of the image. For the text, we use <code>&lt;tspan&gt;</code> to color some words.</p>
<section id="adding-hyperlinks" class="level3">
<h3 class="anchored" data-anchor-id="adding-hyperlinks">Adding hyperlinks</h3>
<p>We use the <code>href</code> attribute within an <code>&lt;a&gt;</code> element wrapped around the text to create a hyperlink.</p>
</section>
<section id="adding-tooltips" class="level3">
<h3 class="anchored" data-anchor-id="adding-tooltips">Adding tooltips</h3>
<p>We add a tooltip by simply adding a <code>&lt;title&gt;</code> elements as a child to whatever element we want to add the tooltip to, as described in the <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Reference/Element/title">documentation</a>. In this case, we add it as a child to the <code>&lt;rect&gt;</code> elements.</p>
</section>
<section id="adding-animation" class="level3">
<h3 class="anchored" data-anchor-id="adding-animation">Adding animation</h3>
<p>We can add animations by using the <code>&lt;animate&gt;</code> element. We do so by adding them inside the <code>&lt;rect&gt;</code> elements. For the left bar, we can simply animate “along” the width of the bar. Since rectangles are always left-aligned in SVG, for the right bar that needs to “grow” to the left, we add an animation both for the width and the x position.</p>
<p>We use <code>fill="freeze"</code> to ensure the rectangles stay in their end position.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>&lt;svg version="1.1"
     width="500" height="100"
     xmlns="http://www.w3.org/2000/svg"&gt;
  &lt;a href="https://www.police.govt.nz/about-us/publications-statistics/data-and-statistics/policedatanz/proceedings-offender-demographics"&gt;
    &lt;text x="0" y="45"
      font-size="28"
      font-family="sans-serif"
      text-anchor="start"&gt;
        Youth Crime:
        &lt;tspan fill="#E46C0A"&gt;Female&lt;/tspan&gt;
        versus
        &lt;tspan fill="#0070C0"&gt;Male&lt;/tspan&gt;
    &lt;/text&gt;
  &lt;/a&gt;
  &lt;svg y="50" width="500" height = "50" viewBox="0 0 100 100" preserveAspectRatio="none"&gt;
    &lt;rect width="0" height="100" fill="#E46C0A"&gt;
      &lt;animate
        attributeName="width"
        from="0"
        to="28.53506"
        dur="1s"
        fill="freeze" /&gt;
        &lt;title&gt; 28,5% of crimes were committed by Females &lt;/title&gt;
    &lt;/rect&gt;
    &lt;rect x="100" width="100" height="100" fill="#0070C0"&gt;
      &lt;animate
        attributeName="width"
        from="0"
        to="71.46494"
        dur="1s"
        fill="freeze" /&gt;
      &lt;animate
        attributeName="x"
        from="100"
        to="28.53506"
        dur="1s"
        fill="freeze" /&gt;
        &lt;title&gt; 72,5% of crimes were committed by Males &lt;/title&gt;
    &lt;/rect&gt;
  &lt;/svg&gt;
&lt;/svg&gt;</code></pre>
</div>
</div>
<div>
<svg version="1.1" width="500" height="100" xmlns="http://www.w3.org/2000/svg">
<a href="https://www.police.govt.nz/about-us/publications-statistics/data-and-statistics/policedatanz/proceedings-offender-demographics"> <text x="0" y="45" font-size="28" font-family="sans-serif" text-anchor="start"> Youth Crime: <tspan fill="#E46C0A">Female</tspan> versus <tspan fill="#0070C0">Male</tspan> </text> </a> <svg y="50" width="500" height="50" viewbox="0 0 100 100" preserveaspectratio="none"> <rect width="0" height="100" fill="#E46C0A"> <animate attributename="width" from="0" to="28.53506" dur="1s" fill="freeze"></animate>
<title>
28,5% of crimes were committed by Females
</title>
</rect> <rect x="100" width="100" height="100" fill="#0070C0"> <animate attributename="width" from="0" to="71.46494" dur="1s" fill="freeze"></animate> <animate attributename="x" from="100" to="28.53506" dur="1s" fill="freeze"></animate>
<title>
72,5% of crimes were committed by Males
</title>
</rect>
</svg>
</svg>
</div>
</section>
<section id="creating-a-button-to-run-the-animation" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-button-to-run-the-animation">Creating a button to run the animation</h3>
<p>We add <code>id="q1"</code> to the <code>&lt;div&gt;</code> element wrapped around our SVG code and then include the following to produce a button:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>script type<span class="ot">=</span><span class="st">"text/javascript"</span><span class="sc">&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> <span class="fu">runAnim</span>() {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    const div <span class="ot">=</span> <span class="fu">document.getElementById</span>(<span class="st">"q1"</span>);</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    const anims <span class="ot">=</span> <span class="fu">div.getElementsByTagName</span>(<span class="st">"animate"</span>);</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (const anim of anims) {</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">anim.beginElement</span>();</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span><span class="er">/</span>script<span class="sc">&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;</span>button id<span class="ot">=</span><span class="st">"button"</span> onclick<span class="ot">=</span><span class="st">"runAnim()"</span><span class="sc">&gt;</span>Play<span class="sc">&lt;</span><span class="er">/</span>button<span class="sc">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="q1">
<svg version="1.1" width="500" height="100" xmlns="http://www.w3.org/2000/svg">
<a href="https://www.police.govt.nz/about-us/publications-statistics/data-and-statistics/policedatanz/proceedings-offender-demographics"> <text x="0" y="45" font-size="28" font-family="sans-serif" text-anchor="start"> Youth Crime: <tspan fill="#E46C0A">Female</tspan> versus <tspan fill="#0070C0">Male</tspan> </text> </a> <svg y="50" width="500" height="50" viewbox="0 0 100 100" preserveaspectratio="none"> <rect width="0" height="100" fill="#E46C0A"> <animate attributename="width" from="0" to="28.53506" dur="1s" fill="freeze"></animate>
<title>
28,5% of crimes were committed by Females
</title>
</rect> <rect x="100" width="100" height="100" fill="#0070C0"> <animate attributename="width" from="0" to="71.46494" dur="1s" fill="freeze"></animate> <animate attributename="x" from="100" to="28.53506" dur="1s" fill="freeze"></animate>
<title>
72,5% of crimes were committed by Males
</title>
</rect>
</svg>
</svg>
</div>
<script type="text/javascript">
function runAnim1() {
    const div = document.getElementById("q1");
    const anims = div.getElementsByTagName("animate");
    for (const anim of anims) {
        anim.beginElement();
    }
}
</script>
<button id="button" onclick="runAnim1()">
Play animation
</button>
</section>
</section>
<section id="question-2" class="level2">
<h2 class="anchored" data-anchor-id="question-2">Question 2</h2>
<p>We create helper functions</p>
<ul>
<li><code>add_text</code>: adds left-aligned text as a child with <code>font-family</code> “sans-serif”.</li>
<li><code>add_barRatioSVG</code>: Creates an <code>&lt;svg&gt;</code> object of specified size with a <code>viewBox</code> enabling us to plot the rate in data within the new native user coordinate system. It then summarises the rate of observations within groups of <code>colvar</code> and creates rectangles using those rates and specified colors.</li>
<li><code>add_text_and_bar</code>: A function to combine <code>add_text</code> and <code>add_barRatioSVG</code>, allocating the top half to the text and the bottom half to the bar of ratios.</li>
<li><code>add_to_facets</code>: A function that splits data by a <code>facetvar</code>, allocates space to the different facets accordingly and then creates an <code>&lt;svg&gt;</code> for each facet and uses a <code>facet_fun</code> inside each facet. As a default it uses <code>add_text_and_bar</code>.</li>
<li><code>svg_facet</code>: A wrapper function that initialises an svg document by calling <code>xml_new_root</code>, and it then uses <code>add_to_facets</code> to create the visualisation.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>add_text <span class="ot">&lt;-</span> <span class="cf">function</span>(.x, <span class="at">label =</span> <span class="st">"Some label"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x =</span> <span class="st">"0"</span>, <span class="at">y =</span> <span class="st">"45"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">text.size =</span> <span class="st">"18"</span>) {</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xml_add_child</span>(.x, <span class="st">"text"</span>, label,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">x=</span>x, <span class="at">y=</span>y,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"font-size"</span><span class="ot">=</span>text.size, <span class="st">"font-family"</span><span class="ot">=</span><span class="st">"sans-serif"</span>, <span class="st">"text-anchor"</span><span class="ot">=</span><span class="st">"start"</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>())</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>add_barRatioSVG <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    .x,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> crime,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Some label"</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">ratevar =</span> <span class="st">"prop"</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">colvar =</span> <span class="st">"SEX"</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"#E46C0A"</span>, <span class="st">"#0070C0"</span>),</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"0"</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"50"</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="st">"500"</span>,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="st">"50"</span>,</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">animate =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create rectangle inside svg object with viewBox specification</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  svg_rect <span class="ot">&lt;-</span> <span class="fu">xml_add_child</span>(</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    .x, <span class="st">"svg"</span>,</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x, <span class="at">y=</span>y, <span class="at">width=</span>width, <span class="at">height =</span> height, <span class="at">viewBox=</span><span class="st">"0 0 1 1"</span>, <span class="at">preserveAspectRatio=</span><span class="st">"none"</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find rates from data</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># data_list &lt;- data %&gt;% </span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   group_split({{colvar}} := get(colvar))</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rates &lt;- sapply(data_list, function(x) x[[ratevar]])</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  data_sum <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(colvar))) <span class="sc">%&gt;%</span> </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop_last"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="at">.keep =</span> <span class="st">"unused"</span>)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use the rates to determine box length and position</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  rect1 <span class="ot">&lt;-</span> <span class="fu">xml_add_child</span>(svg_rect, <span class="st">"rect"</span>,</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>                <span class="at">width=</span><span class="fu">as.character</span>(data_sum<span class="sc">$</span>prop[<span class="dv">1</span>]),</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>                <span class="at">height=</span><span class="st">"1"</span>,</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill=</span>cols[<span class="dv">1</span>])</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  rect2 <span class="ot">&lt;-</span> <span class="fu">xml_add_child</span>(svg_rect, <span class="st">"rect"</span>,</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>                <span class="at">x=</span><span class="fu">as.character</span>(data_sum<span class="sc">$</span>prop[<span class="dv">1</span>]),</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>                <span class="at">width=</span><span class="fu">as.character</span>(data_sum<span class="sc">$</span>prop[<span class="dv">2</span>]),</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>                <span class="at">height=</span><span class="st">"1"</span>,</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill=</span>cols[<span class="dv">2</span>])</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (animate) {</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xml_add_child</span>(rect1, <span class="st">"animate"</span>,</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>                  <span class="at">attributeName=</span><span class="st">"width"</span>,</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">from=</span><span class="st">"0"</span>,</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">to=</span><span class="fu">as.character</span>(data_sum<span class="sc">$</span>prop[<span class="dv">1</span>]),</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">dur=</span><span class="st">"1s"</span>,</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill=</span><span class="st">"freeze"</span>)</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xml_add_child</span>(rect2, <span class="st">"animate"</span>,</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>                  <span class="at">attributeName=</span><span class="st">"width"</span>,</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">from=</span><span class="st">"0"</span>,</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">to=</span><span class="fu">as.character</span>(data_sum<span class="sc">$</span>prop[<span class="dv">2</span>]),</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">dur=</span><span class="st">"1s"</span>,</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill=</span><span class="st">"freeze"</span>)</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xml_add_child</span>(rect2, <span class="st">"animate"</span>,</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>                  <span class="at">attributeName=</span><span class="st">"x"</span>,</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">from=</span><span class="st">"1"</span>,</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>        <span class="at">to=</span><span class="fu">as.character</span>(data_sum<span class="sc">$</span>prop[<span class="dv">1</span>]),</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">dur=</span><span class="st">"1s"</span>,</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill=</span><span class="st">"freeze"</span>)</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add tooltips</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="cn">TRUE</span>) {</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xml_add_child</span>(</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>    rect1, <span class="st">"title"</span>,</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="fu">format</span>(<span class="fu">round</span>(data_sum<span class="sc">$</span>prop[<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="dv">1</span>), <span class="at">nsmall =</span> <span class="dv">1</span>),</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>           <span class="st">"% of crimes were commited by "</span>,</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>           data_sum[[colvar]][<span class="dv">1</span>],</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>           <span class="st">"s in "</span>,</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>           <span class="fu">unique</span>(data<span class="sc">$</span>Police.District))</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xml_add_child</span>(</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>    rect2, <span class="st">"title"</span>,</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="fu">format</span>(<span class="fu">round</span>(data_sum<span class="sc">$</span>prop[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="dv">1</span>), <span class="at">nsmall =</span> <span class="dv">1</span>),</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>           <span class="st">"% of crimes were commited by "</span>,</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>           data_sum[[colvar]][<span class="dv">2</span>],</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>           <span class="st">"s in "</span>,</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>           <span class="fu">unique</span>(data<span class="sc">$</span>Police.District))</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>())</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>add_text_and_bar <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>    .x,</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> crime,</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Some label"</span>,</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">ratevar =</span> <span class="st">"prop"</span>,</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">colvar =</span> <span class="st">"SEX"</span>,</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"#E46C0A"</span>, <span class="st">"#0070C0"</span>),</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"0"</span>,</span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"0"</span>,</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">text.size =</span> <span class="st">"18"</span>,</span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">text.y.offset =</span> <span class="st">"5"</span>,</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="st">"500"</span>,</span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="st">"100"</span>,</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">animate =</span> <span class="cn">FALSE</span></span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>    ) {</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>  args <span class="ot">&lt;-</span> <span class="fu">as.list</span>(<span class="fu">environment</span>())</span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>  y_mid <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">as.numeric</span>(y) <span class="sc">+</span> <span class="fu">as.numeric</span>(height) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>  y_text <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">as.numeric</span>(y_mid) <span class="sc">-</span> <span class="fu">as.numeric</span>(text.y.offset))</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_text</span>(.x, label, <span class="at">x =</span> x, <span class="at">y =</span> y_text)</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>  args<span class="sc">$</span>.x <span class="ot">&lt;-</span> .x</span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>  args<span class="sc">$</span>y <span class="ot">&lt;-</span> y_mid</span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>  args<span class="sc">$</span>height <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">as.numeric</span>(args<span class="sc">$</span>height) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>  args_to_bar <span class="ot">&lt;-</span> args[<span class="fu">names</span>(<span class="fu">formals</span>(add_barRatioSVG))]</span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(add_barRatioSVG, args_to_bar)</span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>())</span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>facetlevels_by_ratevar <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> crime,</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">ratevar =</span> <span class="st">"prop"</span>,</span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">colvar =</span> <span class="st">"SEX"</span>,</span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>    <span class="at">facetvar =</span> <span class="st">"Police.District"</span></span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a>  data_sum <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(facetvar, colvar)))) <span class="sc">%&gt;%</span> </span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop_last"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ratevar :=</span> n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="at">.keep =</span> <span class="st">"unused"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">levels</span>(<span class="fu">reorder</span>(data_sum[[facetvar]], data_sum<span class="sc">$</span>ratevar, <span class="cf">function</span>(x) x[<span class="dv">1</span>]))</span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a>add_to_facets <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a>    .x,</span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">facet_fun =</span> add_text_and_bar,</span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a>    ...,</span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> crime,</span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a>    <span class="at">ratevar =</span> <span class="st">"prop"</span>,</span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a>    <span class="at">colvar =</span> <span class="st">"SEX"</span>,</span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a>    <span class="at">facetvar =</span> <span class="st">"Police.District"</span>,</span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"0"</span>,</span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="st">"500"</span>,</span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="st">"600"</span>) {</span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a>  args <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">as.list</span>(<span class="fu">environment</span>()), <span class="fu">list</span>(...))</span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a>  data[[facetvar]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a>    data[[facetvar]],</span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">facetlevels_by_ratevar</span>(</span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> data, <span class="at">ratevar =</span> ratevar, <span class="at">colvar =</span> colvar, <span class="at">facetvar =</span> facetvar</span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a>  facet_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_split</span>({{facetvar}} <span class="sc">:</span><span class="er">=</span> <span class="fu">get</span>(facetvar))</span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a>  n_facets <span class="ot">&lt;-</span> <span class="fu">length</span>(facet_data)</span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a>  height_facet <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">as.numeric</span>(height) <span class="sc">/</span> n_facets)</span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a>  ys <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(height_facet) <span class="sc">*</span> <span class="dv">0</span><span class="sc">:</span>(n_facets<span class="dv">-1</span>)</span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a>  args_to_facet <span class="ot">&lt;-</span> args</span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a>  args_to_facet<span class="sc">$</span>height <span class="ot">&lt;-</span> height_facet</span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2</span>(<span class="dv">1</span><span class="sc">:</span>n_facets, ys, <span class="cf">function</span>(i, y) {</span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a>    svg_facet <span class="ot">&lt;-</span> <span class="fu">xml_add_child</span>(</span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a>      .x, <span class="st">"svg"</span>,</span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> x, <span class="at">y=</span>y, <span class="at">width=</span>width, <span class="at">height =</span> height_facet</span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-176"><a href="#cb11-176" aria-hidden="true" tabindex="-1"></a>    args_to_facet<span class="sc">$</span>.x <span class="ot">&lt;-</span> svg_facet</span>
<span id="cb11-177"><a href="#cb11-177" aria-hidden="true" tabindex="-1"></a>    args_to_facet<span class="sc">$</span>data <span class="ot">&lt;-</span> facet_data[[i]]</span>
<span id="cb11-178"><a href="#cb11-178" aria-hidden="true" tabindex="-1"></a>    args_to_facet<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">unique</span>(args_to_facet<span class="sc">$</span>data[[facetvar]]))</span>
<span id="cb11-179"><a href="#cb11-179" aria-hidden="true" tabindex="-1"></a>    args_to_facet<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-180"><a href="#cb11-180" aria-hidden="true" tabindex="-1"></a>    args_to_facet <span class="ot">&lt;-</span> <span class="fu">compact</span>(args_to_facet[<span class="fu">names</span>(<span class="fu">formals</span>(facet_fun))])</span>
<span id="cb11-181"><a href="#cb11-181" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(facet_fun, args_to_facet)</span>
<span id="cb11-182"><a href="#cb11-182" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb11-183"><a href="#cb11-183" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-184"><a href="#cb11-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-185"><a href="#cb11-185" aria-hidden="true" tabindex="-1"></a>svg_facet <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb11-186"><a href="#cb11-186" aria-hidden="true" tabindex="-1"></a>    <span class="at">facet_fun =</span> add_text_and_bar,</span>
<span id="cb11-187"><a href="#cb11-187" aria-hidden="true" tabindex="-1"></a>    ...,</span>
<span id="cb11-188"><a href="#cb11-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> crime,</span>
<span id="cb11-189"><a href="#cb11-189" aria-hidden="true" tabindex="-1"></a>    <span class="at">ratevar =</span> <span class="st">"prop"</span>,</span>
<span id="cb11-190"><a href="#cb11-190" aria-hidden="true" tabindex="-1"></a>    <span class="at">colvar =</span> <span class="st">"SEX"</span>,</span>
<span id="cb11-191"><a href="#cb11-191" aria-hidden="true" tabindex="-1"></a>    <span class="at">facetvar =</span> <span class="st">"Police.District"</span>,</span>
<span id="cb11-192"><a href="#cb11-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"0"</span>,</span>
<span id="cb11-193"><a href="#cb11-193" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="st">"500"</span>,</span>
<span id="cb11-194"><a href="#cb11-194" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="st">"600"</span>) {</span>
<span id="cb11-195"><a href="#cb11-195" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-196"><a href="#cb11-196" aria-hidden="true" tabindex="-1"></a>  args <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">as.list</span>(<span class="fu">environment</span>()), <span class="fu">list</span>(...))</span>
<span id="cb11-197"><a href="#cb11-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-198"><a href="#cb11-198" aria-hidden="true" tabindex="-1"></a>  svg <span class="ot">&lt;-</span> <span class="fu">xml_new_root</span>(<span class="st">"svg"</span>,</span>
<span id="cb11-199"><a href="#cb11-199" aria-hidden="true" tabindex="-1"></a>                      <span class="at">version=</span><span class="st">"1.1"</span>,</span>
<span id="cb11-200"><a href="#cb11-200" aria-hidden="true" tabindex="-1"></a>                      <span class="at">width=</span>width, <span class="at">height=</span>height,</span>
<span id="cb11-201"><a href="#cb11-201" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xmlns=</span><span class="st">"http://www.w3.org/2000/svg"</span>)</span>
<span id="cb11-202"><a href="#cb11-202" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-203"><a href="#cb11-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(add_to_facets, <span class="fu">c</span>(<span class="fu">list</span>(<span class="at">.x =</span> svg), args))</span>
<span id="cb11-204"><a href="#cb11-204" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-205"><a href="#cb11-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(svg)</span>
<span id="cb11-206"><a href="#cb11-206" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run the function to save an svg file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># svg &lt;- svg_facet(facet_fun = add_barRatioSVG)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># svg &lt;- svg_facet(facet_fun = add_text)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>svg <span class="ot">&lt;-</span> <span class="fu">svg_facet</span>(<span class="at">animate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_xml</span>(svg, <span class="st">"q2_program.svg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="q2">
<!--?xml version="1.0" encoding="UTF-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="500" height="600">
<svg x="0" y="0" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Auckland City</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.260044660285139" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.260044660285139" dur="1s" fill="freeze"></animate>
<title>
26.0% of crimes were commited by Females in Auckland City
</title>
</rect><rect x="0.260044660285139" width="0.739955339714861" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.739955339714861" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.260044660285139" dur="1s" fill="freeze"></animate>
<title>
74.0% of crimes were commited by Males in Auckland City
</title>
</rect>
</svg>
</svg>
<svg x="0" y="50" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Tasman</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.267037948452273" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.267037948452273" dur="1s" fill="freeze"></animate>
<title>
26.7% of crimes were commited by Females in Tasman
</title>
</rect><rect x="0.267037948452273" width="0.732962051547727" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.732962051547727" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.267037948452273" dur="1s" fill="freeze"></animate>
<title>
73.3% of crimes were commited by Males in Tasman
</title>
</rect>
</svg>
</svg>
<svg x="0" y="100" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Waitemata</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.270004455519068" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.270004455519068" dur="1s" fill="freeze"></animate>
<title>
27.0% of crimes were commited by Females in Waitemata
</title>
</rect><rect x="0.270004455519068" width="0.729995544480932" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.729995544480932" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.270004455519068" dur="1s" fill="freeze"></animate>
<title>
73.0% of crimes were commited by Males in Waitemata
</title>
</rect>
</svg>
</svg>
<svg x="0" y="150" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Wellington</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.271174129064125" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.271174129064125" dur="1s" fill="freeze"></animate>
<title>
27.1% of crimes were commited by Females in Wellington
</title>
</rect><rect x="0.271174129064125" width="0.728825870935875" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.728825870935875" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.271174129064125" dur="1s" fill="freeze"></animate>
<title>
72.9% of crimes were commited by Males in Wellington
</title>
</rect>
</svg>
</svg>
<svg x="0" y="200" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Southern</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.271348261076703" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.271348261076703" dur="1s" fill="freeze"></animate>
<title>
27.1% of crimes were commited by Females in Southern
</title>
</rect><rect x="0.271348261076703" width="0.728651738923297" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.728651738923297" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.271348261076703" dur="1s" fill="freeze"></animate>
<title>
72.9% of crimes were commited by Males in Southern
</title>
</rect>
</svg>
</svg>
<svg x="0" y="250" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Bay Of Plenty</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.290506150148452" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.290506150148452" dur="1s" fill="freeze"></animate>
<title>
29.1% of crimes were commited by Females in Bay Of Plenty
</title>
</rect><rect x="0.290506150148452" width="0.709493849851548" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.709493849851548" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.290506150148452" dur="1s" fill="freeze"></animate>
<title>
70.9% of crimes were commited by Males in Bay Of Plenty
</title>
</rect>
</svg>
</svg>
<svg x="0" y="300" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Canterbury</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.290930312598201" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.290930312598201" dur="1s" fill="freeze"></animate>
<title>
29.1% of crimes were commited by Females in Canterbury
</title>
</rect><rect x="0.290930312598201" width="0.709069687401799" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.709069687401799" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.290930312598201" dur="1s" fill="freeze"></animate>
<title>
70.9% of crimes were commited by Males in Canterbury
</title>
</rect>
</svg>
</svg>
<svg x="0" y="350" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Northland</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.291545880988774" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.291545880988774" dur="1s" fill="freeze"></animate>
<title>
29.2% of crimes were commited by Females in Northland
</title>
</rect><rect x="0.291545880988774" width="0.708454119011226" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.708454119011226" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.291545880988774" dur="1s" fill="freeze"></animate>
<title>
70.8% of crimes were commited by Males in Northland
</title>
</rect>
</svg>
</svg>
<svg x="0" y="400" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Waikato</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.292708784399218" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.292708784399218" dur="1s" fill="freeze"></animate>
<title>
29.3% of crimes were commited by Females in Waikato
</title>
</rect><rect x="0.292708784399218" width="0.707291215600782" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.707291215600782" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.292708784399218" dur="1s" fill="freeze"></animate>
<title>
70.7% of crimes were commited by Males in Waikato
</title>
</rect>
</svg>
</svg>
<svg x="0" y="450" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Counties/Manukau</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.293579482258522" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.293579482258522" dur="1s" fill="freeze"></animate>
<title>
29.4% of crimes were commited by Females in Counties/Manukau
</title>
</rect><rect x="0.293579482258522" width="0.706420517741478" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.706420517741478" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.293579482258522" dur="1s" fill="freeze"></animate>
<title>
70.6% of crimes were commited by Males in Counties/Manukau
</title>
</rect>
</svg>
</svg>
<svg x="0" y="500" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Central</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.302394487048855" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.302394487048855" dur="1s" fill="freeze"></animate>
<title>
30.2% of crimes were commited by Females in Central
</title>
</rect><rect x="0.302394487048855" width="0.697605512951145" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.697605512951145" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.302394487048855" dur="1s" fill="freeze"></animate>
<title>
69.8% of crimes were commited by Males in Central
</title>
</rect>
</svg>
</svg>
<svg x="0" y="550" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Eastern</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.313027363772573" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.313027363772573" dur="1s" fill="freeze"></animate>
<title>
31.3% of crimes were commited by Females in Eastern
</title>
</rect><rect x="0.313027363772573" width="0.686972636227427" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.686972636227427" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.313027363772573" dur="1s" fill="freeze"></animate>
<title>
68.7% of crimes were commited by Males in Eastern
</title>
</rect>
</svg>
</svg>
</svg>
</div>
<script type="text/javascript">
function runAnim2() {
    const div = document.getElementById("q2");
    const anims = div.getElementsByTagName("animate");
    for (const anim of anims) {
        anim.beginElement();
    }
}
</script>
<button id="button" onclick="runAnim2()">
Play animation
</button>
<section id="challenge" class="level2">
<h2 class="anchored" data-anchor-id="challenge">Challenge</h2>
<p>The svg file produces by the function above is pasted <a href="#r-svg-code">at the end of the document</a>. We use the following code to embed a selection menu, which determines which animation to run when the button is pressed:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>script type<span class="ot">=</span><span class="st">"text/javascript"</span><span class="sc">&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> <span class="fu">runAnimSelected</span>() {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    const div <span class="ot">=</span> <span class="fu">document.getElementById</span>(<span class="st">"c"</span>);</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    const menu <span class="ot">=</span> <span class="fu">document.getElementById</span>(<span class="st">"region"</span>);</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    const region <span class="ot">=</span> menu.selectedOptions[<span class="dv">0</span>].value;</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    const allRects <span class="ot">=</span> <span class="fu">div.querySelectorAll</span>(<span class="st">"svg svg rect"</span>);</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    const rect1 <span class="ot">=</span> <span class="sc">+</span>region <span class="sc">*</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    const rect2 <span class="ot">=</span> rect1 <span class="sc">-</span> <span class="dv">1</span>;</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    const anim1 <span class="ot">=</span> allRects[rect1]<span class="fu">.querySelectorAll</span>(<span class="st">"animate"</span>);</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (const anim of anim1) {</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">anim.beginElement</span>();</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    const anim2 <span class="ot">=</span> allRects[rect2]<span class="fu">.querySelectorAll</span>(<span class="st">"animate"</span>);</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (const anim of anim2) {</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">anim.beginElement</span>();</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span><span class="er">/</span>script<span class="sc">&gt;</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;</span>select id<span class="ot">=</span><span class="st">"region"</span><span class="sc">&gt;</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>option value<span class="ot">=</span><span class="st">"1"</span><span class="sc">&gt;</span>Auckland City<span class="sc">&lt;</span><span class="er">/</span>option<span class="sc">&gt;</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>option value<span class="ot">=</span><span class="st">"2"</span><span class="sc">&gt;</span>Tasman<span class="sc">&lt;</span><span class="er">/</span>option<span class="sc">&gt;</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>option value<span class="ot">=</span><span class="st">"3"</span><span class="sc">&gt;</span>Waitemata<span class="sc">&lt;</span><span class="er">/</span>option<span class="sc">&gt;</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>option value<span class="ot">=</span><span class="st">"4"</span><span class="sc">&gt;</span>Wellington<span class="sc">&lt;</span><span class="er">/</span>option<span class="sc">&gt;</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>option value<span class="ot">=</span><span class="st">"5"</span><span class="sc">&gt;</span>Southern<span class="sc">&lt;</span><span class="er">/</span>option<span class="sc">&gt;</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>option value<span class="ot">=</span><span class="st">"6"</span><span class="sc">&gt;</span>Bay Of Plenty<span class="sc">&lt;</span><span class="er">/</span>option<span class="sc">&gt;</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>option value<span class="ot">=</span><span class="st">"7"</span><span class="sc">&gt;</span>Canterbury<span class="sc">&lt;</span><span class="er">/</span>option<span class="sc">&gt;</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>option value<span class="ot">=</span><span class="st">"8"</span><span class="sc">&gt;</span>Northland<span class="sc">&lt;</span><span class="er">/</span>option<span class="sc">&gt;</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>option value<span class="ot">=</span><span class="st">"9"</span><span class="sc">&gt;</span>Waikato<span class="sc">&lt;</span><span class="er">/</span>option<span class="sc">&gt;</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>option value<span class="ot">=</span><span class="st">"10"</span><span class="sc">&gt;</span>Counties<span class="sc">/</span>Manukau<span class="sc">&lt;</span><span class="er">/</span>option<span class="sc">&gt;</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>option value<span class="ot">=</span><span class="st">"11"</span><span class="sc">&gt;</span>Central<span class="sc">&lt;</span><span class="er">/</span>option<span class="sc">&gt;</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>option value<span class="ot">=</span><span class="st">"12"</span><span class="sc">&gt;</span>Eastern<span class="sc">&lt;</span><span class="er">/</span>option<span class="sc">&gt;</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;/</span>select<span class="sc">&gt;</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;</span>button id<span class="ot">=</span><span class="st">"button"</span> onclick<span class="ot">=</span><span class="st">"runAnimSelected()"</span><span class="sc">&gt;</span>Play<span class="sc">&lt;</span><span class="er">/</span>button<span class="sc">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>Note that since we have nested <code>&lt;svg&gt;</code>s, we use the line <code>const allRects = div.querySelectorAll("svg svg rect");</code> to fetch all <code>&lt;rect&gt;</code> elements in the svg file.</p>
</blockquote>
<p>Afterwards we find the indices of the relevant <code>&lt;rect&gt;</code>s corresponding to the selection of region using <code>const rect1 = +region * 2 - 1; const rect2 = rect1 - 1;</code>. Then, we can fetch all the <code>&lt;animation&gt;</code> elements within a corresponding <code>&lt;rect&gt;</code> element with <code>allRects[rectXX].querySelectorAll("animate")</code> and then run the elements with the <code>beginElement</code> method.</p>
<div id="c">
<!--?xml version="1.0" encoding="UTF-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="500" height="600">
<svg x="0" y="0" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Auckland City</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.260044660285139" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.260044660285139" dur="1s" fill="freeze"></animate>
<title>
26.0% of crimes were commited by Females in Auckland City
</title>
</rect><rect x="0.260044660285139" width="0.739955339714861" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.739955339714861" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.260044660285139" dur="1s" fill="freeze"></animate>
<title>
74.0% of crimes were commited by Males in Auckland City
</title>
</rect>
</svg>
</svg>
<svg x="0" y="50" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Tasman</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.267037948452273" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.267037948452273" dur="1s" fill="freeze"></animate>
<title>
26.7% of crimes were commited by Females in Tasman
</title>
</rect><rect x="0.267037948452273" width="0.732962051547727" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.732962051547727" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.267037948452273" dur="1s" fill="freeze"></animate>
<title>
73.3% of crimes were commited by Males in Tasman
</title>
</rect>
</svg>
</svg>
<svg x="0" y="100" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Waitemata</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.270004455519068" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.270004455519068" dur="1s" fill="freeze"></animate>
<title>
27.0% of crimes were commited by Females in Waitemata
</title>
</rect><rect x="0.270004455519068" width="0.729995544480932" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.729995544480932" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.270004455519068" dur="1s" fill="freeze"></animate>
<title>
73.0% of crimes were commited by Males in Waitemata
</title>
</rect>
</svg>
</svg>
<svg x="0" y="150" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Wellington</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.271174129064125" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.271174129064125" dur="1s" fill="freeze"></animate>
<title>
27.1% of crimes were commited by Females in Wellington
</title>
</rect><rect x="0.271174129064125" width="0.728825870935875" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.728825870935875" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.271174129064125" dur="1s" fill="freeze"></animate>
<title>
72.9% of crimes were commited by Males in Wellington
</title>
</rect>
</svg>
</svg>
<svg x="0" y="200" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Southern</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.271348261076703" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.271348261076703" dur="1s" fill="freeze"></animate>
<title>
27.1% of crimes were commited by Females in Southern
</title>
</rect><rect x="0.271348261076703" width="0.728651738923297" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.728651738923297" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.271348261076703" dur="1s" fill="freeze"></animate>
<title>
72.9% of crimes were commited by Males in Southern
</title>
</rect>
</svg>
</svg>
<svg x="0" y="250" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Bay Of Plenty</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.290506150148452" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.290506150148452" dur="1s" fill="freeze"></animate>
<title>
29.1% of crimes were commited by Females in Bay Of Plenty
</title>
</rect><rect x="0.290506150148452" width="0.709493849851548" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.709493849851548" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.290506150148452" dur="1s" fill="freeze"></animate>
<title>
70.9% of crimes were commited by Males in Bay Of Plenty
</title>
</rect>
</svg>
</svg>
<svg x="0" y="300" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Canterbury</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.290930312598201" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.290930312598201" dur="1s" fill="freeze"></animate>
<title>
29.1% of crimes were commited by Females in Canterbury
</title>
</rect><rect x="0.290930312598201" width="0.709069687401799" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.709069687401799" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.290930312598201" dur="1s" fill="freeze"></animate>
<title>
70.9% of crimes were commited by Males in Canterbury
</title>
</rect>
</svg>
</svg>
<svg x="0" y="350" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Northland</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.291545880988774" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.291545880988774" dur="1s" fill="freeze"></animate>
<title>
29.2% of crimes were commited by Females in Northland
</title>
</rect><rect x="0.291545880988774" width="0.708454119011226" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.708454119011226" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.291545880988774" dur="1s" fill="freeze"></animate>
<title>
70.8% of crimes were commited by Males in Northland
</title>
</rect>
</svg>
</svg>
<svg x="0" y="400" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Waikato</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.292708784399218" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.292708784399218" dur="1s" fill="freeze"></animate>
<title>
29.3% of crimes were commited by Females in Waikato
</title>
</rect><rect x="0.292708784399218" width="0.707291215600782" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.707291215600782" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.292708784399218" dur="1s" fill="freeze"></animate>
<title>
70.7% of crimes were commited by Males in Waikato
</title>
</rect>
</svg>
</svg>
<svg x="0" y="450" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Counties/Manukau</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.293579482258522" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.293579482258522" dur="1s" fill="freeze"></animate>
<title>
29.4% of crimes were commited by Females in Counties/Manukau
</title>
</rect><rect x="0.293579482258522" width="0.706420517741478" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.706420517741478" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.293579482258522" dur="1s" fill="freeze"></animate>
<title>
70.6% of crimes were commited by Males in Counties/Manukau
</title>
</rect>
</svg>
</svg>
<svg x="0" y="500" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Central</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.302394487048855" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.302394487048855" dur="1s" fill="freeze"></animate>
<title>
30.2% of crimes were commited by Females in Central
</title>
</rect><rect x="0.302394487048855" width="0.697605512951145" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.697605512951145" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.302394487048855" dur="1s" fill="freeze"></animate>
<title>
69.8% of crimes were commited by Males in Central
</title>
</rect>
</svg>
</svg>
<svg x="0" y="550" width="500" height="50">
<text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start">Eastern</text><svg x="0" y="25" width="500" height="25" viewbox="0 0 1 1" preserveaspectratio="none"><rect width="0.313027363772573" height="1" fill="#E46C0A"><animate attributename="width" from="0" to="0.313027363772573" dur="1s" fill="freeze"></animate>
<title>
31.3% of crimes were commited by Females in Eastern
</title>
</rect><rect x="0.313027363772573" width="0.686972636227427" height="1" fill="#0070C0"><animate attributename="width" from="0" to="0.686972636227427" dur="1s" fill="freeze"></animate><animate attributename="x" from="1" to="0.313027363772573" dur="1s" fill="freeze"></animate>
<title>
68.7% of crimes were commited by Males in Eastern
</title>
</rect>
</svg>
</svg>
</svg>
</div>
<script type="text/javascript">
function runAnimSelected() {
    const div = document.getElementById("c");
    const menu = document.getElementById("region");
    const region = menu.selectedOptions[0].value;
    const allRects = div.querySelectorAll("svg svg rect");
    const rect1 = +region * 2 - 1
    const rect2 = rect1 - 1;
    const anim1 = allRects[rect1].querySelectorAll("animate");
    for (const anim of anim1) {
        anim.beginElement();
    }
    const anim2 = allRects[rect2].querySelectorAll("animate");
    for (const anim of anim2) {
        anim.beginElement();
    }
}
</script>
<p><select id="region"> <option value="1">Auckland City</option> <option value="2">Tasman</option> <option value="3">Waitemata</option> <option value="4">Wellington</option> <option value="5">Southern</option> <option value="6">Bay Of Plenty</option> <option value="7">Canterbury</option> <option value="8">Northland</option> <option value="9">Waikato</option> <option value="10">Counties/Manukau</option> <option value="11">Central</option> <option value="12">Eastern</option> </select> <button id="button" onclick="runAnimSelected()">Play</button></p>
<section id="overall-summary" class="level1">
<h1>Overall summary</h1>
<p>To create a bar of ratios between men and women with a colored title, we write svg code using <code>&lt;text&gt;</code> and <code>&lt;rect&gt;</code> elements, making use of <code>&lt;tspan&gt;</code> to colors words in the title, and using <code>viewBox</code> and <code>preserveAspectRatio</code> attributes to easily use data values inside a coordinate system where we have specified a native scale.</p>
<p>We add hyperlinks using the <code>href</code> attribute inside an <code>&lt;a&gt;</code> element as parent to the <code>&lt;text&gt;</code> element. We add tooltips using … . Lastly, we add animation using an <code>&lt;animation&gt;</code> element as a child of the <code>&lt;rect&gt;</code> element we want to display as an animation. We can even embed a button using javascript that when pressed runs the animation.</p>
<p>In question 2, we do the same again, but here we stratify our data by police district, find values programmatically and create bars with labels inside sub-<code>&lt;svg&gt;</code> elements.</p>
<p>In question 3 we expand on the use of javascript by adding a selection menu of region to run the animation for.</p>
</section>
<section id="r-svg-code" class="level1">
<h1>svg file produced by R function</h1>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="500" height="600"&gt;
  &lt;svg x="0" y="0" width="500" height="50"&gt;
    &lt;text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start"&gt;Auckland City&lt;/text&gt;
    &lt;svg x="0" y="25" width="500" height="25" viewBox="0 0 1 1" preserveAspectRatio="none"&gt;
      &lt;rect width="0.260044660285139" height="1" fill="#E46C0A"&gt;
        &lt;animate attributeName="width" from="0" to="0.260044660285139" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;26.0% of crimes were commited by Females in Auckland City&lt;/title&gt;
      &lt;/rect&gt;
      &lt;rect x="0.260044660285139" width="0.739955339714861" height="1" fill="#0070C0"&gt;
        &lt;animate attributeName="width" from="0" to="0.739955339714861" dur="1s" fill="freeze"/&gt;
        &lt;animate attributeName="x" from="1" to="0.260044660285139" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;74.0% of crimes were commited by Males in Auckland City&lt;/title&gt;
      &lt;/rect&gt;
    &lt;/svg&gt;
  &lt;/svg&gt;
  &lt;svg x="0" y="50" width="500" height="50"&gt;
    &lt;text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start"&gt;Tasman&lt;/text&gt;
    &lt;svg x="0" y="25" width="500" height="25" viewBox="0 0 1 1" preserveAspectRatio="none"&gt;
      &lt;rect width="0.267037948452273" height="1" fill="#E46C0A"&gt;
        &lt;animate attributeName="width" from="0" to="0.267037948452273" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;26.7% of crimes were commited by Females in Tasman&lt;/title&gt;
      &lt;/rect&gt;
      &lt;rect x="0.267037948452273" width="0.732962051547727" height="1" fill="#0070C0"&gt;
        &lt;animate attributeName="width" from="0" to="0.732962051547727" dur="1s" fill="freeze"/&gt;
        &lt;animate attributeName="x" from="1" to="0.267037948452273" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;73.3% of crimes were commited by Males in Tasman&lt;/title&gt;
      &lt;/rect&gt;
    &lt;/svg&gt;
  &lt;/svg&gt;
  &lt;svg x="0" y="100" width="500" height="50"&gt;
    &lt;text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start"&gt;Waitemata&lt;/text&gt;
    &lt;svg x="0" y="25" width="500" height="25" viewBox="0 0 1 1" preserveAspectRatio="none"&gt;
      &lt;rect width="0.270004455519068" height="1" fill="#E46C0A"&gt;
        &lt;animate attributeName="width" from="0" to="0.270004455519068" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;27.0% of crimes were commited by Females in Waitemata&lt;/title&gt;
      &lt;/rect&gt;
      &lt;rect x="0.270004455519068" width="0.729995544480932" height="1" fill="#0070C0"&gt;
        &lt;animate attributeName="width" from="0" to="0.729995544480932" dur="1s" fill="freeze"/&gt;
        &lt;animate attributeName="x" from="1" to="0.270004455519068" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;73.0% of crimes were commited by Males in Waitemata&lt;/title&gt;
      &lt;/rect&gt;
    &lt;/svg&gt;
  &lt;/svg&gt;
  &lt;svg x="0" y="150" width="500" height="50"&gt;
    &lt;text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start"&gt;Wellington&lt;/text&gt;
    &lt;svg x="0" y="25" width="500" height="25" viewBox="0 0 1 1" preserveAspectRatio="none"&gt;
      &lt;rect width="0.271174129064125" height="1" fill="#E46C0A"&gt;
        &lt;animate attributeName="width" from="0" to="0.271174129064125" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;27.1% of crimes were commited by Females in Wellington&lt;/title&gt;
      &lt;/rect&gt;
      &lt;rect x="0.271174129064125" width="0.728825870935875" height="1" fill="#0070C0"&gt;
        &lt;animate attributeName="width" from="0" to="0.728825870935875" dur="1s" fill="freeze"/&gt;
        &lt;animate attributeName="x" from="1" to="0.271174129064125" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;72.9% of crimes were commited by Males in Wellington&lt;/title&gt;
      &lt;/rect&gt;
    &lt;/svg&gt;
  &lt;/svg&gt;
  &lt;svg x="0" y="200" width="500" height="50"&gt;
    &lt;text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start"&gt;Southern&lt;/text&gt;
    &lt;svg x="0" y="25" width="500" height="25" viewBox="0 0 1 1" preserveAspectRatio="none"&gt;
      &lt;rect width="0.271348261076703" height="1" fill="#E46C0A"&gt;
        &lt;animate attributeName="width" from="0" to="0.271348261076703" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;27.1% of crimes were commited by Females in Southern&lt;/title&gt;
      &lt;/rect&gt;
      &lt;rect x="0.271348261076703" width="0.728651738923297" height="1" fill="#0070C0"&gt;
        &lt;animate attributeName="width" from="0" to="0.728651738923297" dur="1s" fill="freeze"/&gt;
        &lt;animate attributeName="x" from="1" to="0.271348261076703" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;72.9% of crimes were commited by Males in Southern&lt;/title&gt;
      &lt;/rect&gt;
    &lt;/svg&gt;
  &lt;/svg&gt;
  &lt;svg x="0" y="250" width="500" height="50"&gt;
    &lt;text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start"&gt;Bay Of Plenty&lt;/text&gt;
    &lt;svg x="0" y="25" width="500" height="25" viewBox="0 0 1 1" preserveAspectRatio="none"&gt;
      &lt;rect width="0.290506150148452" height="1" fill="#E46C0A"&gt;
        &lt;animate attributeName="width" from="0" to="0.290506150148452" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;29.1% of crimes were commited by Females in Bay Of Plenty&lt;/title&gt;
      &lt;/rect&gt;
      &lt;rect x="0.290506150148452" width="0.709493849851548" height="1" fill="#0070C0"&gt;
        &lt;animate attributeName="width" from="0" to="0.709493849851548" dur="1s" fill="freeze"/&gt;
        &lt;animate attributeName="x" from="1" to="0.290506150148452" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;70.9% of crimes were commited by Males in Bay Of Plenty&lt;/title&gt;
      &lt;/rect&gt;
    &lt;/svg&gt;
  &lt;/svg&gt;
  &lt;svg x="0" y="300" width="500" height="50"&gt;
    &lt;text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start"&gt;Canterbury&lt;/text&gt;
    &lt;svg x="0" y="25" width="500" height="25" viewBox="0 0 1 1" preserveAspectRatio="none"&gt;
      &lt;rect width="0.290930312598201" height="1" fill="#E46C0A"&gt;
        &lt;animate attributeName="width" from="0" to="0.290930312598201" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;29.1% of crimes were commited by Females in Canterbury&lt;/title&gt;
      &lt;/rect&gt;
      &lt;rect x="0.290930312598201" width="0.709069687401799" height="1" fill="#0070C0"&gt;
        &lt;animate attributeName="width" from="0" to="0.709069687401799" dur="1s" fill="freeze"/&gt;
        &lt;animate attributeName="x" from="1" to="0.290930312598201" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;70.9% of crimes were commited by Males in Canterbury&lt;/title&gt;
      &lt;/rect&gt;
    &lt;/svg&gt;
  &lt;/svg&gt;
  &lt;svg x="0" y="350" width="500" height="50"&gt;
    &lt;text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start"&gt;Northland&lt;/text&gt;
    &lt;svg x="0" y="25" width="500" height="25" viewBox="0 0 1 1" preserveAspectRatio="none"&gt;
      &lt;rect width="0.291545880988774" height="1" fill="#E46C0A"&gt;
        &lt;animate attributeName="width" from="0" to="0.291545880988774" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;29.2% of crimes were commited by Females in Northland&lt;/title&gt;
      &lt;/rect&gt;
      &lt;rect x="0.291545880988774" width="0.708454119011226" height="1" fill="#0070C0"&gt;
        &lt;animate attributeName="width" from="0" to="0.708454119011226" dur="1s" fill="freeze"/&gt;
        &lt;animate attributeName="x" from="1" to="0.291545880988774" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;70.8% of crimes were commited by Males in Northland&lt;/title&gt;
      &lt;/rect&gt;
    &lt;/svg&gt;
  &lt;/svg&gt;
  &lt;svg x="0" y="400" width="500" height="50"&gt;
    &lt;text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start"&gt;Waikato&lt;/text&gt;
    &lt;svg x="0" y="25" width="500" height="25" viewBox="0 0 1 1" preserveAspectRatio="none"&gt;
      &lt;rect width="0.292708784399218" height="1" fill="#E46C0A"&gt;
        &lt;animate attributeName="width" from="0" to="0.292708784399218" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;29.3% of crimes were commited by Females in Waikato&lt;/title&gt;
      &lt;/rect&gt;
      &lt;rect x="0.292708784399218" width="0.707291215600782" height="1" fill="#0070C0"&gt;
        &lt;animate attributeName="width" from="0" to="0.707291215600782" dur="1s" fill="freeze"/&gt;
        &lt;animate attributeName="x" from="1" to="0.292708784399218" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;70.7% of crimes were commited by Males in Waikato&lt;/title&gt;
      &lt;/rect&gt;
    &lt;/svg&gt;
  &lt;/svg&gt;
  &lt;svg x="0" y="450" width="500" height="50"&gt;
    &lt;text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start"&gt;Counties/Manukau&lt;/text&gt;
    &lt;svg x="0" y="25" width="500" height="25" viewBox="0 0 1 1" preserveAspectRatio="none"&gt;
      &lt;rect width="0.293579482258522" height="1" fill="#E46C0A"&gt;
        &lt;animate attributeName="width" from="0" to="0.293579482258522" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;29.4% of crimes were commited by Females in Counties/Manukau&lt;/title&gt;
      &lt;/rect&gt;
      &lt;rect x="0.293579482258522" width="0.706420517741478" height="1" fill="#0070C0"&gt;
        &lt;animate attributeName="width" from="0" to="0.706420517741478" dur="1s" fill="freeze"/&gt;
        &lt;animate attributeName="x" from="1" to="0.293579482258522" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;70.6% of crimes were commited by Males in Counties/Manukau&lt;/title&gt;
      &lt;/rect&gt;
    &lt;/svg&gt;
  &lt;/svg&gt;
  &lt;svg x="0" y="500" width="500" height="50"&gt;
    &lt;text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start"&gt;Central&lt;/text&gt;
    &lt;svg x="0" y="25" width="500" height="25" viewBox="0 0 1 1" preserveAspectRatio="none"&gt;
      &lt;rect width="0.302394487048855" height="1" fill="#E46C0A"&gt;
        &lt;animate attributeName="width" from="0" to="0.302394487048855" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;30.2% of crimes were commited by Females in Central&lt;/title&gt;
      &lt;/rect&gt;
      &lt;rect x="0.302394487048855" width="0.697605512951145" height="1" fill="#0070C0"&gt;
        &lt;animate attributeName="width" from="0" to="0.697605512951145" dur="1s" fill="freeze"/&gt;
        &lt;animate attributeName="x" from="1" to="0.302394487048855" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;69.8% of crimes were commited by Males in Central&lt;/title&gt;
      &lt;/rect&gt;
    &lt;/svg&gt;
  &lt;/svg&gt;
  &lt;svg x="0" y="550" width="500" height="50"&gt;
    &lt;text x="0" y="20" font-size="18" font-family="sans-serif" text-anchor="start"&gt;Eastern&lt;/text&gt;
    &lt;svg x="0" y="25" width="500" height="25" viewBox="0 0 1 1" preserveAspectRatio="none"&gt;
      &lt;rect width="0.313027363772573" height="1" fill="#E46C0A"&gt;
        &lt;animate attributeName="width" from="0" to="0.313027363772573" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;31.3% of crimes were commited by Females in Eastern&lt;/title&gt;
      &lt;/rect&gt;
      &lt;rect x="0.313027363772573" width="0.686972636227427" height="1" fill="#0070C0"&gt;
        &lt;animate attributeName="width" from="0" to="0.686972636227427" dur="1s" fill="freeze"/&gt;
        &lt;animate attributeName="x" from="1" to="0.313027363772573" dur="1s" fill="freeze"/&gt;
        &lt;title&gt;68.7% of crimes were commited by Males in Eastern&lt;/title&gt;
      &lt;/rect&gt;
    &lt;/svg&gt;
  &lt;/svg&gt;
&lt;/svg&gt;</code></pre>
</div>
</div>


</section>
</section></section></section><a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main></div>





 <!-- /main -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mathiaslj/stats787uoa-data-visualisation/blob/main/labs/lab9_answer.Rmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div></div></footer><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/mathiaslj\.github\.io\/stats787uoa-data-visualisation\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
 <!-- /content -->




</body></html>